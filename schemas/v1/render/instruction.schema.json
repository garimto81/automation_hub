{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://automation-hub/schemas/v1/render/instruction",
  "title": "Render Instruction",
  "description": "렌더링 지시서 - automation_sub가 생성, automation_ae가 처리",
  "type": "object",
  "required": ["template_name"],
  "properties": {
    "id": {
      "type": ["integer", "null"],
      "description": "DB ID (자동 생성)"
    },
    "template_name": {
      "type": "string",
      "maxLength": 100,
      "description": "AE 템플릿 이름"
    },
    "layer_data": {
      "type": "object",
      "additionalProperties": true,
      "description": "AE 템플릿에 주입할 레이어 데이터",
      "examples": [
        {
          "player_name": "John Doe",
          "chip_count": "$1,000,000",
          "position": "1st"
        }
      ]
    },
    "output_settings": {
      "$ref": "#/$defs/OutputSettings",
      "description": "출력 설정"
    },
    "output_path": {
      "type": ["string", "null"],
      "maxLength": 500,
      "description": "출력 경로"
    },
    "output_filename": {
      "type": ["string", "null"],
      "maxLength": 200,
      "description": "출력 파일명"
    },
    "status": {
      "$ref": "../common/enums.schema.json#/$defs/RenderStatus",
      "default": "pending"
    },
    "priority": {
      "type": "integer",
      "minimum": 1,
      "maximum": 10,
      "default": 5,
      "description": "우선순위 (1=최고, 10=최저)"
    },
    "trigger_type": {
      "type": ["string", "null"],
      "maxLength": 50,
      "description": "트리거 타입 (예: premium_hand, elimination)"
    },
    "trigger_id": {
      "type": ["string", "null"],
      "maxLength": 100,
      "description": "트리거 ID (관련 핸드/이벤트 ID)"
    },
    "error_message": {
      "type": ["string", "null"],
      "description": "에러 메시지"
    },
    "retry_count": {
      "type": "integer",
      "minimum": 0,
      "default": 0,
      "description": "재시도 횟수"
    },
    "max_retries": {
      "type": "integer",
      "minimum": 0,
      "default": 3,
      "description": "최대 재시도 횟수"
    },
    "created_at": {
      "type": "string",
      "format": "date-time"
    },
    "started_at": {
      "type": ["string", "null"],
      "format": "date-time"
    },
    "completed_at": {
      "type": ["string", "null"],
      "format": "date-time"
    }
  },
  "$defs": {
    "OutputSettings": {
      "type": "object",
      "properties": {
        "format": {
          "$ref": "../common/enums.schema.json#/$defs/OutputFormat",
          "default": "png_sequence"
        },
        "width": {
          "type": "integer",
          "minimum": 1,
          "default": 1920,
          "description": "출력 너비 (픽셀)"
        },
        "height": {
          "type": "integer",
          "minimum": 1,
          "default": 1080,
          "description": "출력 높이 (픽셀)"
        },
        "fps": {
          "type": "integer",
          "minimum": 1,
          "default": 30,
          "description": "프레임 레이트"
        },
        "duration_frames": {
          "type": ["integer", "null"],
          "minimum": 1,
          "description": "출력 프레임 수"
        },
        "quality": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "default": 90,
          "description": "품질 (1-100)"
        }
      }
    }
  }
}
